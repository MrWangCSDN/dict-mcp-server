# 模式路由与防干扰规则

本文档用于解决“联机交易元数据”和“复合类型元数据”互相干扰问题。

## 1. 模式判定

### 联机交易模式

命中任一条件即进入联机交易模式：

- 用户给出交易码：`TC|TD|TG|TY + 4位数字`
- 用户明确提到 `*.flowtrans.xml`

### 复合类型模式

命中任一条件即进入复合类型模式：

- 用户提到“复合类型”“复合对象”
- 用户明确提到 `*.c_schema.xml`
- 用户给出 `schema` / `complexType` 语义描述

### 混合模式

同一请求同时包含上述两类信号时，进入混合模式并拆分处理。

## 2. 模式冲突处理

当判定冲突或信息不足时，必须先澄清：

- 目标文件扩展名是什么？
- 是交易码驱动，还是 schema id 驱动？
- 需要产出一个文件还是两个文件？

未澄清前不得直接生成 XML。

## 3. 防干扰硬约束

- 不在 `*.flowtrans.xml` 中使用 `schema/complexType/element` 结构
- 不在 `*.c_schema.xml` 中使用 `flowtran/interface/input/output` 结构
- 不混用命名规则：
  - 交易码规则仅用于联机交易
  - `schema id` 规则仅用于复合类型
- 复合对象引用优先判断：
  - 若字段 `type` 为 `{SchemaId}.{ComplexTypeId}`，视为复合对象引用，不查字典，不写 `ref`
  - 其他字段再走字典 MCP 查询

## 4. 混合模式执行规范

1. 将任务拆为两个子任务（联机交易 / 复合类型）
2. 分别生成或修改各自文件
3. 分别给出路径与变更摘要
4. 分别汇总未贯标字段，避免跨模式合并统计
