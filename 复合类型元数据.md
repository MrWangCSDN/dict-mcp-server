# 复合类型元数据说明（`*.c_schema.xml`）

本文档用于指导复合类型（复合对象）元数据文件的创建、修改和删除，适用于提到“复合类型”“复合对象”“`c_schema.xml`”的场景。

## 1. 基本定义

- 复合类型文件本质是一个包含多个 `complexType` 的 XML 元数据文件。
- 一个 `complexType` 对应一个 Java Bean 风格对象。
- 文件命名规则：`{SchemaId}.c_schema.xml`，且 `{SchemaId}` 必须与 `schema@id` 一致并全局唯一。

## 2. 文件结构与固定约束

### 2.1 XML 头

- 固定为：`<?xml version="1.0" encoding="UTF-8" standalone="yes"?>`

### 2.2 `schema` 标签

- `xmlns:xsi` 固定为 `http://www.w3.org/2001/XMLSchema-instance`
- `id`：复合类型文件唯一标识（也是文件名前缀）
- `package`：按领域映射到对应模块包路径
- `longname`：复合类型中文名
- `classgen`：默认 `auto`
- `xsi:noNamespaceSchemaLocation`：默认 `ltts-model.xsd`

## 3. 包路径与模块映射

### 3.1 领域到包路径

- 存款：`com.spdb.ccbs.dept.resources.type` / `com.spdb.ccbs.dept.beans.type`
- 贷款：`com.spdb.ccbs.loan.resources.type` / `com.spdb.ccbs.loan.beans.type`
- 结算：`com.spdb.ccbs.sett.resources.type` / `com.spdb.ccbs.sett.beans.type`
- 平台公共：`com.spdb.ccbs.comm.resources.type` / `com.spdb.ccbs.comm.beans.type`

### 3.2 领域到模块

- 存款：`dept-resources` / `dept-beans`
- 贷款：`loan-resources` / `loan-beans`
- 结算：`sett-resources` / `sett-beans`
- 平台公共：`comm-resources` / `comm-beans`

## 4. `complexType` 规则

一个 `complexType` 表示一个复合对象。

- `id`：对象英文名（对应生成类名），同一文件内唯一
- `longname`：对象中文名
- 默认属性：
  - `abstract="false"`
  - `dict="false"`
  - `introduct="false"`
  - `localName=""`
  - `extension=""`
  - `tags=""`

## 5. 字段（`element`）规则

> 历史文件里可能出现 `elemment`（拼写差异），新增内容统一使用 `element`。

- `id`：字段英文名（来自字典 MCP）
- `longname`：字段中文名（来自字典 MCP）
- `type`：字段类型（来自字典 MCP）
- `required`：是否必输。未明确时默认 `false`
- `multi`：`true` 表示集合，`false` 表示单值
- `range`：默认 `false`
- `array`：默认 `false`
- `final`：默认 `false`
- `override`：默认 `false`
- `allowSubType`：默认 `true`
- `key`：默认 `false`
- `ref`：字段字典引用（来自字典 MCP）

### 5.1 未贯标字段处理

- 字典 MCP 查询返回 `null` 的字段视为未贯标
- 未贯标字段不写入 XML
- 输出汇总提示：`{字段中文名} 未贯标`

## 6. 复合类型引用规则（对象/对象数组）

当字段类型引用另一个复合类型时：

- `type` 使用：`{SchemaId}.{ComplexTypeId}`
- 不再填写 `ref`
- 该字段无需查询字典 MCP
- `multi="false"` 表示对象
- `multi="true"` 表示对象数组（List）

示例：

```xml
<element required="false" multi="false" range="false" array="false" final="false" override="false" allowSubType="true" key="false" type="SyndAgrmLoanType.SysdAgrmLoanInfoPojo" longname="银团贷款出资份额信息" id="lstSyndAgrmLoanQryOutPojo"/>
```

## 7. 参考模板

```xml
<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<schema xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" id="FtAcctgType" package="com.spdb.ccbs.loan.resources.type.ft.repay" longname="福费延还款复合类型" classgen="auto" xsi:noNamespaceSchemaLocation="ltts-model.xsd">
    <complexType abstract="false" dict="false" id="FtAcctRepayChkInPojo" introduct="false" localName="" longname="福费延还款校验输入" extension="" tags="">
        <element id="fRFTGDueBillCd" longname="福费延借据编码" type="MBaseType.U_DAI_KUAN_JIE_JU_BIAN_MA" required="false" multi="false" range="false" array="false" final="false" override="false" allowSubType="true" key="false" ref="MDict.F.fRFTGDueBillCd"/>
        <element id="fncgBsnID" longname="融资业务编码" type="MBaseType.U_RONG_ZI_YE_WU_BIAN_MA" required="false" multi="false" range="false" array="false" final="false" override="false" allowSubType="true" key="false" ref="MDict.F.fncgBsnID"/>
    </complexType>
    <complexType abstract="false" dict="false" id="FtAcctRepayChkOutPojo" introduct="false" localName="" longname="福费延还款校验输出" extension="" tags="">
        <element id="fRFTGDueBillCd" longname="福费延借据编码" type="MBaseType.U_DAI_KUAN_JIE_JU_BIAN_MA" required="false" multi="false" range="false" array="false" final="false" override="false" allowSubType="true" key="false" ref="MDict.F.fRFTGDueBillCd"/>
        <element id="fncgBsnID" longname="融资业务编码" type="MBaseType.U_RONG_ZI_YE_WU_BIAN_MA" required="false" multi="false" range="false" array="false" final="false" override="false" allowSubType="true" key="false" ref="MDict.F.fncgBsnID"/>
    </complexType>
</schema>
```

## 8. 触发与操作范围

- 触发关键词：`复合类型`、`复合对象`、`c_schema.xml`
- 支持操作：创建、修改、删除